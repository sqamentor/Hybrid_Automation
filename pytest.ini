[pytest]
# ========================================================================
# PYTEST CONFIGURATION
# ========================================================================

# Test Discovery
python_files = test_*.py *_test.py bookslots_*.py bookslot_*.py
python_classes = Test*
python_functions = test_*
testpaths = tests pages

# Minimum Python version
minversion = 7.0

# Asyncio Configuration  
# Use 'strict' mode: ONLY async def test functions are wrapped in event loop
# Sync tests (like Playwright sync API tests) run normally without async wrapping
asyncio_mode = strict

# ========================================================================
# MARKERS
# ========================================================================

markers =
    # Asyncio control
    no_asyncio: Mark test to run without asyncio wrapper (for sync Playwright tests)
    
    # Project markers (for project-specific test filtering)
    bookslot: Tests for Bookslot application (appointment booking system)
    patientintake: Tests for PatientIntake application (patient data management)
    callcenter: Tests for CallCenter application (call center operations)
    
    # Engine selection markers
    modern_spa: Modern single-page application (Playwright preferred)
    legacy_ui: Legacy user interface (Selenium preferred)
    mobile: Mobile-responsive testing
    api_validation: Requires API validation
    playwright: Tests using Playwright engine
    selenium: Tests using Selenium engine
    
    # Human behavior markers
    human_like: Apply human-like behavior simulation (typing delays, mouse movements, etc.)
    no_human_behavior: Disable human behavior for this test (faster execution)
    
    # Module markers
    module: Specify application module (e.g., checkout, admin, dashboard)
    ui_framework: Specify UI framework (e.g., React, Vue, Angular, JSP)
    auth_type: Authentication type (e.g., SSO, MFA, OAuth, Basic)
    
    # Test categories
    smoke: Smoke tests (quick validation)
    regression: Regression test suite
    unit: Unit tests (isolated component testing)
    integration: Integration tests (UI + API + DB)
    ui_only: UI-only tests
    api_only: API-only tests
    db_only: Database-only tests
    performance: Performance and load tests
    
    # Advanced features
    ai_enhanced: AI-enhanced validation and testing
    enhanced_features: Tests for enhanced framework features
    multi_project: Cross-project integration tests
    
    # Workflow markers (for cross-engine multi-step workflows)
    workflow: Multi-step cross-engine workflow test
    requires_authentication: Test requires authentication (SSO/MFA/etc.)
    sso_dependent: Test depends on prior SSO login step
    ui_sequential: Test must run in sequence with other tests (not parallel)
    workflow_step: Individual step within a larger workflow
    
    # Priority markers
    critical: Critical path tests
    high: High priority
    medium: Medium priority
    low: Low priority
    
    # Environment markers
    dev_only: Run only in development
    staging_only: Run only in staging
    prod_safe: Safe to run in production (read-only)
    
    # Special markers
    slow: Slow running tests
    skip_ci: Skip in CI/CD pipeline
    flaky: Known flaky test (needs attention)
    wip: Work in progress

# ========================================================================
# COMMAND LINE OPTIONS
# ========================================================================

# Default command line options
addopts =
    # Verbose output
    -v
    # Show summary of all test outcomes
    -ra
    # Show local variables in tracebacks
    --showlocals
    # Capture output (no/yes/all)
    --capture=no
    # Disable warnings summary
    --disable-warnings
    # Generate HTML report
    --html=reports/test_report.html
    --self-contained-html
    # Allure results
    --alluredir=allure-results
    # Strict markers (fail on unknown markers)
    --strict-markers
    # Show extra test summary
    --tb=short

# ========================================================================
# LOGGING
# ========================================================================

log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# ========================================================================
# WARNINGS
# ========================================================================

filterwarnings =
    # Ignore specific warnings
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # You can add specific warnings to show
    # error::UserWarning

# ========================================================================
# TIMEOUTS
# ========================================================================

# Default timeout for all tests (in seconds)
timeout = 300
timeout_method = thread

# ========================================================================
# COVERAGE (if pytest-cov is installed)
# ========================================================================

# [coverage:run]
# source = framework
# omit =
#     */tests/*
#     */venv/*
#     */__pycache__/*

# [coverage:report]
# precision = 2
# show_missing = True
# skip_covered = False

# ========================================================================
# XDIST (Parallel Execution)
# ========================================================================

# Number of parallel workers (auto = number of CPUs)
# Can be overridden with: pytest -n auto
# Or specify number: pytest -n 4

# ========================================================================
# CUSTOM OPTIONS
# ========================================================================

# Environment selection
# Usage: pytest --env=staging
# Configured via conftest.py

# Browser selection  
# Usage: pytest --browser=chrome
# Configured via conftest.py

# Headless mode
# Usage: pytest --headless
# Configured via conftest.py

# ========================================================================
# PLAYWRIGHT SPECIFIC
# ========================================================================

# Playwright browser (chromium, firefox, webkit)
# Can be overridden with: pytest --browser chromium

# Playwright headed/headless
# Can be overridden with: pytest --headed

# Playwright slow motion (milliseconds)
# Can be overridden with: pytest --slowmo=500

# Playwright tracing
# Can be overridden with: pytest --tracing=on

# ========================================================================
# SELENIUM SPECIFIC  
# ========================================================================

# Browser for Selenium tests
# Can be configured via environment variables or conftest.py

# ========================================================================
# TEST ORDERING
# ========================================================================

# Run tests in specific order
# Configured via pytest-ordering if installed
# Example: @pytest.mark.run(order=1)

# ========================================================================
# RETRIES (if pytest-rerunfailures is installed)
# ========================================================================

# Automatically retry failed tests
# Usage: pytest --reruns 2 --reruns-delay 1

# ========================================================================
# COLLECTION
# ========================================================================

# Don't collect tests from these directories
norecursedirs = 
    .git
    .tox
    dist
    build
    *.egg
    venv
    env
    __pycache__
    .pytest_cache
    node_modules
    allure-results
    allure-report
    logs
    reports
    screenshots
    videos
    traces

# ========================================================================
# INI OPTIONS
# ========================================================================

# Consider these paths as importable
pythonpath = .

# Don't show warnings for missing __init__.py
consider_namespace_packages = True
